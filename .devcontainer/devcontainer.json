{
    "name": "Infra-Ops Development",
    
    "image": "mcr.microsoft.com/devcontainers/base:ubuntu-24.04",
    
    "features": {
        "ghcr.io/devcontainers/features/docker-in-docker:2": {
            "version": "latest",
            "enableNonRootDocker": true,
            "moby": true
        },
        
        "ghcr.io/devcontainers/features/kubectl-helm-minikube:1": {
            "version": "1.34.0",
            "helm": "3.19.0", 
            "minikube": "none"
        },
        
        "ghcr.io/devcontainers/features/node:1": {
            "nodeGypDependencies": true,
            "version": "lts"
        },
        
        "ghcr.io/devcontainers/features/common-utils:2": {
            "upgradePackages": true,
            "username": "vscode"
        }
    },
    
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-kubernetes-tools.vscode-kubernetes-tools",
                "redhat.vscode-yaml",
                "ms-vscode.vscode-json",
                "ms-azuretools.vscode-docker"
            ],
            "settings": {
                "terminal.integrated.defaultProfile.linux": "bash",
                "terminal.integrated.profiles.linux": {
                    "bash": {
                        "path": "/bin/bash",
                        "icon": "terminal-bash"
                    }
                }
            }
        }
    },
    
    "runArgs": ["--privileged"],
    
    "mounts": [
        "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
    ],
    
    "remoteEnv": {
        "KUBECONFIG": "/home/vscode/.kube/config",
        "ARGOCD_PORT": "9090",
        "K3D_LB_PORT": "8080"
    },
    
    "forwardPorts": [9090, 8080],
    
    "portsAttributes": {
        "9090": {
            "label": "ArgoCD UI",
            "onAutoForward": "notify"
        },
        "8080": {
            "label": "k3d Load Balancer",
            "onAutoForward": "silent"
        }
    },
    
    "postCreateCommand": "bash .devcontainer/setup.sh",
    "postStartCommand": "mkdir -p /home/vscode/.kube && kubectl config view > /dev/null 2>&1 || true",
    
    "hostRequirements": {
        "cpus": 2,
        "memory": "4gb",
        "storage": "32gb"
    }
}
